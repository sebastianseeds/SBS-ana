# SBS-ana

Platform and framework for analyzing data from the SBS spectrometer located at JLab Hall A.

## Table of Contents

- [Introduction](#introduction)
- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
- [Project Structure](#project-structure)
- [Contributing](#contributing)
- [Contact Information](#contact-information)
- [License](#license)

## Introduction

SBS-ana is a comprehensive platform designed for the analysis of data collected from the Super Bigbite Spectrometer (SBS) at Jefferson Lab Hall A. The framework supports various stages of data processing, including data acquisition, configuration, and detailed analysis.

## Features

- Data acquisition and preprocessing
- Configuration management
- Extensive analysis tools
- Jupyter Notebook integration for interactive data exploration

## Installation

### Prerequisites

- C++ compiler
- C compiler
- Cern ROOT framework
- G4SBS (a Geant4-based event generator and particle tracking simulation software)
- simc_gfortran (MarkKJones fork, BigBite branch)
- SBS-offline (data reconstruction for SBS)
- SBS-replay (database and reconstruction configuration files)
- Analyzer (Hall A decoding and general reconstruction software)
- Jupyter Notebooks (JLab)
- Additional dependencies listed in the `config` directory

### Steps

1. Clone the repository:
    ```sh
    git clone https://github.com/sebastianseeds/SBS-ana.git
    cd SBS-ana
    ```

2. Install necessary dependencies:

    All necessary steps for installation can be found in the [JLab internal DocDB] (https://sbs.jlab	.org/cgi-bin/DocDB/private/ShowDocument?docid=423)

## Usage

### Running Analysis

Each analysis script contains several arguments aimed at a limited analysis purpose. Scripts will contain a preamble comment describing the script's purpose and a comment before MAIN which explains each argument.

The Project Structure section gives a brief explanation of each script.

The general workflow for these analyses begins with a second reconstruction pass with parse_* scripts. These scripts produce output .root files with a parsed tree "P" containing new calculated quantities, but otherwise far fewer branches with a flat, single-value-per-event structure. Very wide cuts are used on these data which do not compromise the later course and fine cut analysis. This parsing is applied to both experimental data and MC.

With these parsed files, many correlation plots are generated with the plotWithCuts* scripts. These scripts generate 2D dx correlation histograms with wide and tight cuts (user configured). These plots are operated on by most other analysis scripts to extract fine cuts. Other scripts operate on the parsed .root file directly to extract quantities like proton detection efficiency and MC kinematic variable distributions (for example).

The .root files generated by parse_* can be analyzed easily due to the flat structure and smaller file size. Each file contains all available data by kinematic and target (optionally).

## Project Structure

```sh
SBS-ana/
├── analysis/ # Analysis scripts and tools
│ ├── db/ # Scripts to modify database files
│ │ ├── HCal_genDBoffsets.C # Generates HCal db parameters with passed offsets
│ │ ├── hcal_offsets.C # Same as HCal_genDBoffsets, old formatting
│ │ └── outfiles/ # Directory containing database output files
│ ├── example/ # Simple code to serve as a heuristic for other analyses
│ │ ├── calculateXYexp.C # Uses e' track to calculate elastic projections
│ │ ├── hcal_cluster_selection.C # Implements various algorithms to select best HCal cluster
│ │ └── outfiles/ # Contains example root output (git ignored)
│ ├── gana/ # General analysis of GMn data
│ │ ├── archive/ # Several old scripts kept at the ready for algorithms
│ │ ├── convenience/ # Scripts to perform calculations and file management
│ │ │ ├── data/ # Contains Sachs FF world data from 50yrs QCD
│ │ │ ├── archive/ # Contains convenience/ archive scripts
│ │ │ ├── plots/ # Contains plot output from scripts in convenience/
│ │ │ ├── calcRS.C # Uses R' and epsilon values (SBS8/9) and error to calculate RSn and FFR
│ │ │ ├── calc_simc_FF.C # Calculates GEp/GMp/GMn/(GEn) from Kelly(Riordan) fits in SIMC
│ │ │ ├── displayElasticCuts.C # Displays general cut params from json (depr 7.24)
│ │ │ ├── dxdy_overlay.C # dx:dy overlay script for visulization
│ │ │ ├── extract_GMn_from_simc.C # Uses global fits and R' data to extract GMn
│ │ │ ├── GMnElasPeak.C # Calculates various exp parameters by kinematic
│ │ │ ├── GMnQ2recon.C # Calculates Q2 by BBCal shower col
│ │ │ ├── makeCutTables.C # Generates LaTeX tables from cut parameters
│ │ │ ├── makeLongCutTable.C # Generates one long LaTeX table from cut parameters
│ │ │ ├── plot_epsilon_vs_Q2.C # Uses kinematic info to plot eps vs Q2 over GMn run group
│ │ │ ├── sortcsv.C # Sorts simc mc .csv in terms of job number
│ │ │ ├── kinGMn.sh # Executes GMnElasPeak.C with given kinematic only
│ │ │ ├── moveFiles.sh # Executes mass move of MC files (depr 5.24)
│ │ │ ├── Q2recon.sh # Executes GMnQ2recon.C with given kinematic only
│ │ │ └── outfiles/ # Contains plots and text output from scripts
│ │ ├── effmaps/ # Contains output of pHDEmap.C. Includes sorting script.
│ │ ├── rsf_comparison/ # Contains comparative analysis of Rsf over several BGs
│ │ │ ├── plotRsfData.C # Plots rsfdata.txt extracted scale factor ratios for comparison
│ │ │ └── rsfdata.txt # Several datapoints for Rsf with different BGs (depr 7.24)
│ │ ├── traces/ # Contains hashes and versions of software compatible with this analysis
│ │ ├── trigbits_per_run/ # Contains text files with trigbits per run after reconstruction
│ │ ├── wapp/ # Contains wapp generator and dwnbending track analysis scripts
│ │ │ └── analyze_dwnbending.C # Extracts HCal E spectra from dwnbending and endpoint cuts
│ │ ├── all_trigbits.C # Script to check trigbits on all kinematic files after recon
│ │ ├── analyzeCorrelations.C # Script to compare cut correlations from MC with data
│ │ ├── BGStability.C # Script to extract GMn from several BGs and get GMn and syst error
│ │ ├── binStability.C # Script to extract N bins range stable in Rsf
│ │ ├── coinStability.C # Script to extract fine BBCal - HCal cut with Rsf extractions
│ │ ├── dyStability.C # Script to extract fine dy cut with Rsf extractions
│ │ ├── eOverPStability.C # Script to extract fine e' E/p cut with Rsf extractions
│ │ ├── fidnew.C # Script to get course fid cuts with elastic/spot selection on x/y exp
│ │ ├── fiducialStability.C # Script to extract fine fid with Rsf extractions (depr 6.24)
│ │ ├── finalAnalysis.C # Script combining slice and BG analysis (depr 4.24)
│ │ ├── getMCeps.C # Gets epsilon distributions from MC per kinematic
│ │ ├── getMCpN.C # Gets nucleon momentum distributions from MC per kinematic
│ │ ├── getMCQ2.C # Gets Q2 distributions from MC per kinematic
│ │ ├── hcaleStability.C # Script to extract fine HCal E cut with Rsf extractions
│ │ ├── jackknifeAnalysis.C # Script to run over jacknife samples and extract Rsf
│ │ ├── jacknifeSamples.C # Produces several jacknife samples from random run ranges
│ │ ├── LED_hcalE.C # Course script to look for LED triggers and plot HCal E spectra
│ │ ├── neutron_peak_diagnostic.C # Script to extract neutron peak location by kinematic
│ │ ├── npHDE.C # Script to extract n:p ratio and nucleon HDE. Used to obtain course cuts
│ │ ├── parse_barebones.C # General parsing script for data (second reconstruction)
│ │ ├── parse_mc_barebones.C # General parsing script for MC (second reconstruction)
│ │ ├── parse_mcbg_barebones.C # General parsing script for inelastic MC (second recon)
│ │ ├── pHDEmap.C # Script to extract proton HDE with nucleon spot check method
│ │ ├── plotHCalEnergy.C # Script to plot data/MC HCal E comparison on hardcoded kine
│ │ ├── plotHistogramsAndCorrelations.C # Script to plot all cut coorelations together
│ │ ├── plotWithCuts_bc.C # General script to plot 2D dx vs cut correlation histograms (data)
│ │ ├── plotWithCuts_mc.C # General script to plot 2D dx vs cut correlation histograms (MC)
│ │ ├── posRes.C # Script to extract HCal position resolution from dx and dy
│ │ ├── pseSlices.C # Script to extract Rsf from independent BBCal PS E slices
│ │ ├── pseStability.C # Script to extract fine BBCal PS E cut with Rsf extractions
│ │ ├── rangeStability.C # Script to extract fine cut range settings with Rsf extractions
│ │ ├── run_all_LEDhcal.sh # Executes LED_hcalE.C over all kinematics and fields
│ │ ├── run_all_parse_barebones.sh # Executes LED_hcalE.C over all kinematics and fields
│ │ ├── run_some_nphde.sh # Executes npHDE.C over several kinematics and fields
│ │ ├── run_some_parse_barebones.sh # Executes parse_barebones_bc.C over kin and fields
│ │ ├── run_some_pwcbc.sh # Executes plotWithCuts_bc.C over several kinematics and fields
│ │ ├── run_some_pwcmc.sh # Executes plotWithCuts_mc.C over several kinematics and fields
│ │ ├── run_some_rstab.sh # Executes rangeStability.C over several kinematics and fields
│ │ ├── simpleBinning.C # Plots dx comparisons with several bin range types
│ │ ├── spotSizeCal.C # Script to extract number of peak sigma dx/dy with 97% total data
│ │ ├── systHDE.C # Script to extract syst error due to HDE position variation (SBS8)
│ │ ├── tdcInternalRes.C # Script to extract HCAL TDC resolution from adjacent block diff
│ │ ├── tdcTimeRes.C # Script to extract HCAL TDC resolution over all blocks, elastics
│ │ ├── W2datamc.C # Script to fit W2 from MC (elastic and inel) to data
│ │ └── W2Stability.C # Script to extract fine W2 cut with Rsf extractions
│ ├── gmn/ # Broad scale scripts to build distributions from gmn simulations
│ │ ├── archive/ # Contains gmn/ archive scripts
│ │ ├── test_scripts/ # Short scripts used to create more robust versions
│ │ ├── mc_data_compare.C # Script to extract MC HDE and compare with data
│ │ ├── mc_inelastic.C # Script to build MC inelastic histograms
│ │ └── mc_rc.C # Script to build MC elastic histograms
│ ├── hde/ # Scripts to extract proton HCal detection efficiency with fit methods from data
│ │ ├── archive/ # Contains hde/ archive scripts
│ │ ├── hde_ana.C # General script to extract p HDE with dx sideband and W2 anticut methods
│ │ ├── hde_dataloop.C # Direct script to extract p HDE from dx with detailed fit methods
│ │ ├── run_dl_twoset.sh # Executes hde_dataloop.C over two sets of data
│ │ ├── run_many_hde.sh # Executes hde_ana.C over many sets of data
│ │ ├── run_some_hde.sh # Executes hde_ana.C over a few sets of data
│ │ └── outfiles/ # Directory containing output .txt and .root files
│ ├── hea/ # Scripts to examine HCAL ADC reconstructed energy variables
│ │ └── hadc_ped.C # Script to use ADC and ped-sub ADC to evaluate ped on HCal E spectra
│ ├── hta/ # Scripts to extract timing resolution from full waveform data
│ │ ├── hatime_c.C # Script to extract optimized waveform ADC time with various corrections
│ │ ├── hclusblk_res.C # Script to extract optimized ADC time from single channels
│ │ ├── htres.C # Script to extract optimized TDC from single channels
│ │ ├── rf_tdc.C # Script which compares rf time with various reference time subtractions
│ │ ├── params/ # Directory containing ADC and TDC offset parameters from HCal calibs
│ │ └── outfiles/ # Directory containing charge information
│ ├── mc_hde/ # Scripts to extract nucleon HDE from MC
│ │ ├── archive/ # Contains mc_hde/ archive scripts
│ │ ├── simdirect/ # Directory containing MC HDE extraction dependencies
│ │ ├── hde_mc.C # Script to extract HCal E spectra from raw G4SBS output
│ │ ├── hde_mc_getEmean.C # Script to extract mean E from hde_mc.C output
│ │ ├── hde_mc_data.C # Script to use means and spectra to extract HDE from MC
│ │ ├── params/ # Directory containing ADC and TDC offset parameters from HCal calibs
│ │ └── outfiles/ # Directory containing charge information
│ ├── mc_pos/ # Scripts to extract position resolution from MC
│ │ ├── mcreplayed_pos.C # Script to extract position resolution with dx/dy from MC
│ │ ├── plot_sbs4_comparison.C # Script to compare data/MC pos res (depr 4.24)
│ │ ├── run_mcreplayed_pos.sh # Executes mcreplayed_pos.C for one kinematic
│ │ └── outfiles/ # Directory containing charge information
│ ├── meanE/ # Scripts to extract/manipulate mean energy and charge from scalar tree
│ │ ├── getcharge.ipynb # Jupyter notebook with detailed charge extractions
│ │ ├── getmeanE.C # Script to read energy and charge from configuration .csv
│ │ ├── tstE.C # Script to read energy from configuration .csv
│ │ ├── parse.C # Script which extracts charge from scalar tree
│ │ └── epout/ # Directory containing charge information
│ ├── python/ # Scripts to plot extractions and world data (Jupyter Notebooks)
│ │ ├── archive/ # Contains python/ archive scripts
│ │ ├── correlations.ipynb # Jupyter notebook plotting cut correlations with uproot
│ │ ├── mc_plots.ipynb # Jupyter notebook plotting mc variables with uproot (long tree)
│ │ ├── mc_plots_short.ipynb # Jupyter notebook plotting mc variables (short tree)
│ │ ├── mc_plots_veryshort.ipynb # Jupyter notebook plotting mc variables (very short tree)
│ │ ├── update_plot.ipynb # Jupyter notebook to add var slider to tree vars (defunct)
│ │ └── world_data.ipynb # Jupyter notebook which plots world data, fits, and extractions
│ ├── simsf/ # Scripts to predict MC field scale with interpolations from many simulations
│ │ ├── archive/ # Contains simsf/ archive scripts
│ │ ├── sf_dxdy.C # Script to extract proton and neutron peak positions from MC
│ │ ├── sf_getFidVar.C # Read output from sf_dxdy.C and get variance due to fid cuts
│ │ ├── sf_graph.C # Script to aggregate several outputs from sf_dxdy.C
│ │ ├── run_sf_dxdy_all.sh # Executes sf_dxdy.C for all course MC field settings in SBS-9
│ │ ├── run_sf_dxdy_fine_all.sh # Executes sf_dxdy.C for all fine MC field settings in SBS-9
│ │ └── data/ # Directory containing output .root files
│ ├── test/ # Scratch test scripts kept for included algorithms
│ └── vis_aid/ # Scripts to plot raw reconstructed data
│   └── nocut_hists.C # Script to plot several histograms without cuts without parse
├── config/ # Contains configuration .json files used with analysis scripts
│ └── archive/ # Contains config/ archive scripts
├── data/ # Contains configuration .csv files used with analysis scripts
├── include/ # Contains header files for source code and metavariables
│ ├── crun.h # Header for read runlist (.csv) functions
│ ├── cut.h # Header for acceptance and fiducial cuts
│ ├── econst.h # Header for experimental constant calculations and constants
│ ├── etune.h # Header for tuned cuts by kinematic
│ ├── extract.h # Header for GMn extractions from world data fit parameterizations
│ ├── fits.h # Header for user-defined fit functions
│ ├── gmn.h # gmn-ana namespace and declarations
│ ├── json.hpp # Header for base read .json functions
│ ├── jsonmgr.h # Header for gmn-ana expanded read .json functions
│ ├── physconst.h # Header containing physical constants
│ ├── rvars.h # Header for automated branch setting by variable
│ ├── util.h # Header for (many) utility functions
│ └── vars.h # Header for kinematic variable calculation functions
├── mc_calibrations/ # Scripts and data files for MC momentum and optics calibrations
│ ├── archive/ # Contains mc_calibrations/ archive scripts
│ ├── momentum/ # Scripts and data for momentum calibrations. Adapted from sbs-replay.git
│ └── optics/ # Scripts and data for optics calibrations. Adapted from sbs-replay.git
├── misc/ # Miscellaneous files
│ └── epics_out/ # Output data charge and energy extractions from scalar tree 
├── src/ # Source code
│ ├── archive/ # Contains src/ archive scripts
│ ├── cut.C # Functions performing acceptance and fiducial cuts
│ ├── econst.C # Functions performing experimental constant calculations
│ ├── etune.C # Functions performing tuned cuts by kinematic
│ ├── extract.C # Functions performing GMn extractions from world data fit parameterizations
│ ├── fits.C # Functions performing user-defined fits
│ ├── jsonmgr.C # Functions performing gmn-ana expanded read .json
│ ├── rvars.C # Functions performing automated branch setting by variable
│ ├── util.C # Functions performing (many) utility functions
│ └── vars.C # Functions performing kinematic variable calculation
└── README.md # This file
```
## Contributing

If you would like to contribute to this analysis, please contact me.

## Contact Information

This project is maintained by Sebastian, a PhD candidate at UConn and working at Jefferson Lab (JLab). For any questions or inquiries about this project, you can reach me at:

- Email: sebastian.seeds@uconn.edu

---

## License

This project is part of my PhD research at Jefferson Lab (JLab). Usage of this code is primarily intended for academic and research purposes. If you have any questions regarding the use of this code, please contact me.
